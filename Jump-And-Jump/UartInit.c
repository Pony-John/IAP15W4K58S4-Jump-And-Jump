#include <stc15.h>
#include <string.h>


void UartInit()		//9600bps@11.0592MHz
{
	SCON = 0x50;		//8???,?????
	AUXR |= 0x40;		//???1???Fosc,?1T
	AUXR &= 0xFE;		//??1?????1???????
	TMOD &= 0x0F;		//?????1?16???????
	TL1 = 0xE0;		//??????
	TH1 = 0xFE;		//??????
	ET1 = 0;		//?????1??
	TR1 = 1;		//?????1
}

void UartInit3(void)		//9600bps@11.0592MHz
{
	S3CON = 0x10;		//8位数据,可变波特率
	S3CON &= 0xBF;		//串口3选择定时器2为波特率发生器
	AUXR |= 0x04;		//定时器2时钟为Fosc,即1T
	T2L = 0xE0;		//设定定时初值
	T2H = 0xFE;		//设定定时初值
	AUXR |= 0x10;		//启动定时器2
}
void UART_Send_Byte(unsigned char dat)
{
	//ES=0;		 // ??????????,??????
	SBUF = dat;
	while(!TI);	    
 	TI=0;	 //??????,??????????,??????????????
	//ES=1;
}	

void UART_Send_Buff(const char* src)
{
	unsigned char len = strlen(src);
	while(len)
	{
		UART_Send_Byte(*src);
		src++;
		len--;
	}
}

unsigned char Long_Str(long dat,unsigned char *str) // ??????????,?????????????
{
	signed char i=0;
	unsigned char len = 0;
	unsigned char buf[11];	   // ??????4294967295,?ASCII????10+1=11?? 
	if (dat < 0)               // ?????,??????,?????
	{
		dat = -dat;
		*str++ = '-';
		len++;
	}
	do 
	{                               // ????????????
		buf[i++] = dat % 10+0x30;	// C??????????0??
		dat /= 10;
	} while (dat > 0);
    len += i;                 // i?????????????
    while (i-- > 0)           // ????????????
    {
        *str++ = buf[i] ;
    }     
	*str = 0;                 // ????????????KEIL????????????
	return len;               // ???????
}